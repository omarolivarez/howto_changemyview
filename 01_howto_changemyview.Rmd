---
title: "01 How To changemyview"
output: pdf_document
---

Steps to run before this
1. Download Google Sheet
2. Run through LIWC and save as xlsx
3. Clean up first 3 col names
4. Make sure file keeps same name (liwc_results_changemyview.xlsx) and filepath. 

Then you can start from here

```{r}
# READ IN LIBRARIES
library(data.table)
library(readr)
library(ggplot2)
library(tidyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(stringr) # used to replace strings " of "
library(ggpubr) # used to stitch multiple graphs together
library(readxl) # to read in excel
library(corrplot) # to draw correlogram
library(corrr) # to focus correlation specifically on changedview
library(lmtest) # for likelihood test for glm
```


```{r}
df_file_path <- "/Users/OmarOlivarez/Desktop/workspaces/howto_changemyview/data/liwc_results_changemyview.xlsx"

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

# and read in main, LIWCed data
df <- read_excel(df_file_path)

View(df)
head(df)
```

Need to convert changedview from character to numeric in order to use correlations and other calculations. 
```{r}
df$changedview <- as.numeric(df$changedview)
```


Let's select only relevant vars and see their correlation coefficient
```{r}
mini_df <- df %>%
  select(-c(area, text, WC))

corr_df <- mini_df %>% correlate() %>% focus(changedview) 

corr_df <- corr_df %>% 
  arrange(desc(corr_df$changedview))
View(corr_df)
```

Words highly positively correlated with changing view (above 0.2 corr):
cause
work
*conj
*focuspresent
*work
*Sixltr
*interrog
*power

Words highly negatively correlated with changing view (below -0.2 corr):
number
ingest
leisure
negemo
certain
time

## More robust analyses
Let's visualize the distribution of the two variables at the extremes
```{r}
ggplot(df, aes(x = cause, y = changedview)) +
  geom_point() + 
  theme(panel.background = element_rect(fill = "white", colour= "black")) +
  theme(panel.grid.major = element_line(linetype = "dashed", color = "gray"))

ggplot(df, aes(x = number, y = changedview)) +
  geom_point() + 
  theme(panel.background = element_rect(fill = "white", colour= "black")) +
  theme(panel.grid.major = element_line(linetype = "dashed", color = "gray"))
```

Now let's run a logistic regression using the above variables

```{r}
logit_view1 <- glm(changedview ~ cause, data = df)
summary(logit_view1)

logit_view2 <- glm(changedview ~ cause + number, data = df)
summary(logit_view2)

logit_view4 <- glm(changedview ~ cause +
                     number + ingest + negemo, 
                   family = binomial, 
                   data = df)

summary(logit_view4)
```

Let's run a likelihood ratio test on model3 vs model1
```{r}
lrtest(logit_view1, logit_view4)

```




```{r}
ggplot(df, aes(x=cause, y= changedview)) + 
  geom_point(alpha=.5) +
  stat_smooth(method="glm", fullrange=TRUE, 
              method.args = list(family=binomial)) 
```




Just playing around a bit:

```{r}
set.seed(222)
test_obs              <- round(0.1 * nrow(df))
train_obs             <- nrow(df) - test_obs
test_train_vec        <- c(rep("test", test_obs),
                           rep("train", train_obs))

test_train_vec        <- sample(test_train_vec, nrow(df), replace = FALSE)
test_data             <- df[which(test_train_vec == "test"),]
train_data            <- df[which(test_train_vec == "train"),]

# create the model
glm_model      <- glm(changedview ~ cause +
                     number + ingest + negemo,
                     family = binomial,
                     data = train_data)

# make the predictions
logistic_predict      <- predict(glm_model,
                                 test_data,
                                 type = "response")

# show the results
head(logistic_predict, 20)
head(test_data$changedview, 20)

```
67% accuracy




```{r}
```




```{r}
```






```{r}
```





```{r}
```
